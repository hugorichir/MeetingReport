<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const loginSection = document.getElementById('login-section');
            const createOrgSection = document.getElementById('create-organization-section');

            function generateRandomID() {
                return Math.random().toString(36).substr(2, 9);
            }

            async function saveOrganizationToPackageJSON(orgName, orgID) {
                const filePath = './package.json';
                try {
                    const response = await fetch(filePath);
                    let packageData = {};

                    if (response.ok) {
                        packageData = await response.json();
                    }

                    if (!packageData.organizations) {
                        packageData.organizations = [];
                    }

                    packageData.organizations.push({ id: orgID, name: orgName });

                    const blob = new Blob([JSON.stringify(packageData, null, 2)], { type: 'application/json' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'package.json';
                    link.click();
                } catch (error) {
                    console.error('Error updating package.json:', error);
                    alert('Une erreur est survenue lors de la mise à jour de package.json');
                }
            }

            window.showCreateOrganizationForm = function() {
                loginSection.style.display = 'none';
                createOrgSection.style.display = 'block';
            };

            window.createOrganization = function() {
                const orgName = document.getElementById('new-organization-name').value.trim();
                const orgPhoto = document.getElementById('organization-photo').files[0];

                if (!orgName) {
                    alert('Veuillez entrer un nom d\'organisation.');
                    return;
                }

                const orgID = generateRandomID();
                alert(`Organisation "${orgName}" créée avec l'ID: ${orgID}`);

                saveOrganizationToPackageJSON(orgName, orgID);
            };
        });

        /**
         * JSON Format Example for package.json:
         * {
         *   "organizations": [
         *     {
         *       "id": "random_id",
         *       "name": "Organization Name"
         *     }
         *   ]
         * }
         */
    </script>
</head>
<body>
    <header class="header">
        <h1>Bienvenue</h1>
    </header>

    <!-- Login Section -->
    <section id="login-section">
        <h2>Connectez-vous à votre organisation</h2>
        <input type="text" id="organization-id" placeholder="ID de l'organisation">
        <button onclick="alert('Connexion en cours...')">Se connecter</button>
        <button onclick="showCreateOrganizationForm()">Créer une organisation</button>
    </section>

    <!-- Create Organization Section -->
    <section id="create-organization-section" style="display: none;">
        <h2>Créer une nouvelle organisation</h2>
        <form id="create-organization-form">
            <label for="new-organization-name">Nom de l'organisation :</label>
            <input type="text" id="new-organization-name" placeholder="Nom de l'organisation" required>
            <br>
            <label for="organization-photo">Ajouter une photo :</label>
            <input type="file" id="organization-photo" accept="image/*">
            <br>
            <button type="button" onclick="createOrganization()">Créer</button>
        </form>
    </section>
</body>
</html>
